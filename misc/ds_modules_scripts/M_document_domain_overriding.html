<!DOCTYPE html>
<html>
<head>
<title>
Document.domain Testing
</title>
<script type="text/javascript" src="/js/results.js"> </script>
</head>

<body>
<textarea id="user_script" style="display:none;">
<html>
<head>
<title>
Testing with IFRAME
</title>
<script src="/js/results.js"> </script>
</head>
<body>
<h1> Testing</h1>
</body>
<script>
// User script
// Hooks the getter of Obj.prop


function hook(Obj, prop, newValue){
try{
	Object.defineProperty(Obj, prop, {
		'get': function(){ return newValue;}
	});
}	
	
catch(err){
	console.log(err, Obj, prop);
}
	
}

function test(x, y){
	// We need to separate properties and access one by one.
	var tmp;
	var before = this[x];
	
	var prop = y.split('.');
	
	for(tmp in prop){
		before = before[prop[tmp]]
	}

	
	hook(this[x], y, 'test_xyz_value');
	var after = this[x];
	for(tmp in prop){
		after = after[prop[tmp]]
	}	

	if(	before == after){
		console.log(x + '.'+ y +' Not Changed');
	} else {
		console.log(x + '.'+ y +' Changed');
	}
}




</textarea>

<h1>Document.domain Testing</h1>
<script>
var userScript = document.getElementById('user_script').innerText;

function newIframe(injectMe){
	var iframe = document.createElement('iframe');
	iframe.onload = function(){ injectScript(this, injectMe)}
	document.body.appendChild(iframe);
	
return iframe;
}

function removeMe(node){
	return node.parentNode.removeChild(node);
}

function injectScript(iframe, inject){
	iframe.contentWindow.document.write(inject);
}

var data = [['window', 'postMessage.name'], ['document', 'domain'], ['window', 'document.location'], ['location', 'href'], ['document', 'body.innerHTML'], ['document', 'location.origin'], ['window', 'location']];

for(x in data){
	new_iframe = newIframe(userScript+" " + "test('"+ data[x][0] + "', '" + data[x][1] + "'); </scr" + "ipt></bod"+ "y></htm"+ "l>");
}

</script>

</body>
</html>