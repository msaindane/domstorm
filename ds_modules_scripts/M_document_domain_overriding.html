<!DOCTYPE html>
<html>
<head>
<title>
Document.domain Testing
</title>
<script type="text/javascript" src="/js/results.js"> </script>
</head>

<body>
<textarea id="user_script" style="display:none;">

// User script
// Hooks the getter of Obj.prop


function hook(Obj, prop, newValue){
console.log(Obj,typeof Obj, prop);
try{
	Object.defineProperty(Obj, prop, {
		'get': function(){ return newValue;}
	});
}	
	
catch(err){
	alert(err, Obj, prop);
}
	
}

function test(Obj,prop){
	var before = Obj[prop];
	hook(Obj, prop, 'xyz);
	var after = Obj[prop];

	if(	before == after){
		alert(Obj + ' . '+ prop +' Not Changed');
	} else {
		alert(Obj + ' . '+ prop +' Changed');
	}
}

var data = [[document, 'domain'], [window.document, 'location'], [location, 'href']];
var i=0;
for(i=0; i<data.length; i++){
	test(data[i][0], data[i][1]);
}




</textarea>

<h1>Document.domain Testing</h1>
<script>
function newIframe(){
	var iframe = document.createElement('iframe');
	iframe.src = "/pages/iframe.html";
	document.body.appendChild(iframe);
return iframe;
}

function removeMe(node){
	return node.parentNode.removeChild(node);
}

function injectScript(iframe, userScript){
	var inject = "<h1>Injected Script</h1><scri"+''+"pt>" + userScript + "</scri"+''+"pt>";
	iframe.contentWindow.document.write(inject);
}

var new_iframe = newIframe();
var userScript = document.getElementById('user_script').innerText;
injectScript(new_iframe, userScript);


</script>

</body>
</html>